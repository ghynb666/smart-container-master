# 智能货柜Demo项目开发计划

## 项目开发规则

1. **规则1**：本项目为个人学习用demo，功能实现以学习为主要目的
2. **规则2**：功能开发优先级基于其缺失对项目的影响程度评估结果确定
3. **规则3**：任何需要对接外部平台接口的功能，均采用模拟实现方式，不进行实际接口对接

## 一、功能缺失影响程度评估

### 1. 高影响程度功能（导致流程中断，核心功能无法使用）

| 功能名称      | 影响描述                    | 技术模块        |
| --------- | ----------------------- | ----------- |
| 设备开仓门功能   | 预授权成功后无法打开仓门，用户无法取货     | 设备服务、通信服务   |
| 分布式锁释放功能  | 可能导致设备/仓门被永久锁定，影响后续用户使用 | 订单服务、分布式锁管理 |
| 重量对比与商品识别 | 无法确定用户实际购买的商品，无法完成真实支付  | 设备服务、重量数据处理 |
| 支付完成处理    | 订单无法正常完成，资金无法正常结算       | 订单服务、支付处理   |

### 2. 中影响程度功能（功能不完整，但不影响核心流程运行）

| 功能名称     | 影响描述           | 技术模块       |
| -------- | -------------- | ---------- |
| 关门检测功能   | 无法自动检测用户是否关闭仓门 | 设备服务、传感器检测 |
| 实际支付金额计算 | 无法准确计算实际支付金额   | 订单服务、价格计算  |
| 前端扫码入口   | 用户无法发起购买请求     | 前端界面、API接口 |
| 库存扣减功能   | 无法自动更新商品库存     | 库存管理、订单服务  |

### 3. 低影响程度功能（细节功能缺失，对整体流程影响较小）

| 功能名称     | 影响描述          | 技术模块      |
| -------- | ------------- | --------- |
| 优惠券/积分处理 | 无法处理用户优惠券和积分  | 营销服务、订单服务 |
| 消费记录生成   | 无法生成用户消费记录    | 订单服务、用户服务 |
| 补货触发功能   | 无法自动触发补货任务    | 设备服务、库存管理 |
| 订单通知功能   | 无法向用户发送订单完成通知 | 通知服务、订单服务 |

## 二、开发计划

### 1. 第一阶段：高影响程度功能开发

#### 1.1 设备开仓门功能

* **开发顺序**：1

* **模拟实现方案**：

  * 在 `DeviceOperateBizImpl.createOrderOpenGate` 方法中添加模拟开仓门逻辑

  * 记录开仓门日志，模拟设备响应

  * 不实际调用通信服务，仅模拟成功响应

* **验收标准**：

  * 预授权成功后调用设备服务开仓门接口

  * 开仓门操作记录日志

  * 设备状态更新为开门状态

#### 1.2 分布式锁释放功能

* **开发顺序**：2

* **模拟实现方案**：

  * 在 `OrderBizImpl.agreementSignCallBack` 方法中添加预授权成功时的锁释放逻辑

  * 确保在所有场景下锁都能正确释放

* **验收标准**：

  * 预授权成功后正确释放分布式锁

  * 极端情况下（如异常）锁也能释放

  * 设备/仓门可以被其他用户正常使用

#### 1.3 重量对比与商品识别功能

* **开发顺序**：3

* **模拟实现方案**：

  * 创建重量对比服务，模拟前后重量数据

  * 基于重量差模拟识别用户购买的商品

  * 返回模拟的商品列表和数量

* **验收标准**：

  * 能接收开门前和关门后的重量数据

  * 能根据重量差识别出购买的商品

  * 返回正确的商品信息和数量

#### 1.4 支付完成处理功能

* **开发顺序**：4

* **模拟实现方案**：

  * 完善订单状态流转逻辑

  * 添加支付完成处理方法

  * 模拟支付成功响应

* **验收标准**：

  * 订单状态能从预授权成功流转到已支付

  * 支付完成后更新订单信息

  * 生成支付记录

### 2. 第二阶段：中影响程度功能开发

#### 2.1 关门检测功能

* **开发顺序**：5

* **模拟实现方案**：

  * 添加关门检测服务，模拟仓门传感器数据

  * 当检测到关门事件时触发后续流程

* **验收标准**：

  * 能模拟检测到仓门关闭事件

  * 关闭事件能触发重量对比流程

  * 记录关门日志

#### 2.2 实际支付金额计算功能

* **开发顺序**：6

* **模拟实现方案**：

  * 根据识别出的商品计算实际支付金额

  * 模拟商品价格数据

  * 返回计算结果

* **验收标准**：

  * 能根据商品列表计算总金额

  * 计算结果正确

  * 记录价格计算日志

#### 2.3 前端扫码入口

* **开发顺序**：7

* **模拟实现方案**：

  * 创建简单的前端页面，模拟扫码功能

  * 提供订单创建API接口

  * 模拟用户扫码流程

* **验收标准**：

  * 前端页面能显示扫码界面

  * 能调用订单创建接口

  * 能显示订单创建结果

#### 2.4 库存扣减功能

* **开发顺序**：8

* **模拟实现方案**：

  * 添加库存管理服务，模拟库存数据

  * 根据购买的商品扣减库存

  * 更新库存记录

* **验收标准**：

  * 能根据购买商品扣减库存

  * 库存数据更新正确

  * 记录库存变动日志

### 3. 第三阶段：低影响程度功能开发

#### 3.1 优惠券/积分处理功能

* **开发顺序**：9

* **模拟实现方案**：

  * 添加优惠券管理服务，模拟优惠券数据

  * 模拟优惠券使用和积分增减逻辑

* **验收标准**：

  * 能模拟使用优惠券

  * 能模拟增减积分

  * 记录优惠券和积分变动日志

#### 3.2 消费记录生成功能

* **开发顺序**：10

* **模拟实现方案**：

  * 添加消费记录服务，生成用户消费记录

  * 记录消费详情

* **验收标准**：

  * 能生成消费记录

  * 消费记录信息完整

  * 记录消费日志

#### 3.3 补货触发功能

* **开发顺序**：11

* **模拟实现方案**：

  * 添加补货管理服务，模拟库存预警

  * 当库存低于阈值时触发补货任务

* **验收标准**：

  * 能检测库存阈值

  * 能生成补货任务

  * 记录补货日志

#### 3.4 订单通知功能

* **开发顺序**：12

* **模拟实现方案**：

  * 添加通知服务，模拟订单通知

  * 支持多种通知方式（短信、站内信等）

* **验收标准**：

  * 能发送订单通知

  * 通知内容正确

  * 记录通知日志

## 三、开发技术栈

* 后端：Spring Boot、Spring Cloud、MyBatis、Redis、RocketMQ

* 前端：HTML、CSS、JavaScript、Vue.js（可选）

* 数据库：MySQL

* 开发工具：IDEA、Maven

## 四、开发注意事项

1. 所有功能实现均以模拟为主，不进行实际的外部接口对接
2. 重点关注功能流程的完整性和正确性
3. 保持代码的可扩展性，便于后续真实实现
4. 详细记录开发日志和测试结果
5. 遵循项目现有的代码规范和架构设计

## 五、验收标准

1. 每个功能模块都能按照设计要求正常工作
2. 功能之间的流程衔接顺畅
3. 系统运行稳定，无明显错误
4. 代码结构清晰，注释完整
5. 提供详细的测试报告和功能说明文档

